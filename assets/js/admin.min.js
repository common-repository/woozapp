(function($){"use strict";function iframeSourceLoder(){var $urlField=$("#site_url");$(".main-content .woozapp-loader").clone().appendTo(".site-frame").css({backgroundColor:"transparent"}).children("img").css({maxWidth:"30px"});if($urlField.length){$urlField.on("blur",function(){var $iframe=$("iframe#site");$iframe.fadeOut(350,function(){$(".site-frame .woozapp-loader").fadeIn();var regexp=/^http[s]?:\/\/(www\.|[a-zA-Z0-9]+\.)?[a-zA-Z0-9\\/]+(\.[a-zA-Z0-9]{2,6})([a-zA-z0-9\\/]+)?$/,src=$urlField.val();if(regexp.test(src)){$.ajax({url:ajaxurl,data:{action:"delegate",delegate:"frame",src:src},method:"POST",success:function(data){$iframe.replaceWith(data);$(".site-frame .woozapp-loader").delay(300).fadeOut(350,function(){$iframe.fadeIn()})}})}})})}}function removeInvalidFieldDescription(){var invalidDesc=this.parentElement.getElementsByClassName("woozapp-field-invalid-desc");if(invalidDesc.length){Array.prototype.forEach.call(invalidDesc,function(el){el.remove()})}}function addInvalidFieldDescription(msg,wrap){var description=this.parentElement.getElementsByClassName("woozapp-field-description")[0];if(typeof description!=="undefined"&&!wrap){this.parentElement.removeChild(description)}if(wrap){msg='<span class="woozapp-field-invalid-desc">'+msg+"</span>"}this.parentElement.insertAdjacentHTML("beforeend",msg)}function checkFileInputImageResolution(file){var current=this,fileReader=new FileReader;fileReader.onload=function(){switch(file.type){case"image/jpeg":case"image/png":var dataSize=current.getAttribute("data-size");if(dataSize){var res=dataSize.split("x").map(function(el){return parseInt(el)})}var image=new Image;image.src=this.result;image.onload=function(){if(dataSize){if(res[0]<parseInt(this.width)||res[1]<parseInt(this.height)){addInvalidFieldDescription.call(current,current.getAttribute("data-wrong-size"))}}};break;default:break}};fileReader.readAsDataURL(file)}function validateInputs(){var inputs=document.querySelectorAll(".woozapp-form")[0].elements;if(!inputs.length){return false}Array.prototype.forEach.call(inputs,function(el){var type=el.getAttribute("type");if(type){switch(type){case"file":el.addEventListener("change",function(){var current=this;if(!current.files.length){return false}removeInvalidFieldDescription.call(current);var file=this.files[0];var maxSize=parseInt(this.getAttribute("data-max-file-size"));var fileName=current.parentElement.querySelectorAll(".filename");if(!fileName.length){current.parentElement.insertAdjacentHTML("afterbegin",'<span class="filename">'+file.name+"</span>")}else{fileName[0].innerHTML=file.name}if(file.size>maxSize){addInvalidFieldDescription.call(this,this.getAttribute("data-wrong-file-size"))}},false);break;default:el.addEventListener("keyup",function(){if(!this.getAttribute("pattern")){return false}var regExp=new RegExp(this.getAttribute("pattern"));removeInvalidFieldDescription.call(this);if(regExp.test(this.value)){this.classList.remove("invalid");this.classList.add("valid")}else{this.getAttribute("data-invalid")&&addInvalidFieldDescription.call(this,this.getAttribute("data-invalid"),true);this.classList.remove("valid");this.classList.add("invalid")}},false);break}}})}function ajaxSubmit(){var form=document.querySelector(".woozapp-form");if(!form.length){return false}form.addEventListener("submit",function(e){if(typeof window.FormData!=="undefined"){e.preventDefault();var fd=new FormData(this);fd.append("action","delegate");fd.append("delegate",form.getAttribute("name"));$.ajax({url:ajaxurl,data:fd,enctype:"multipart/form-data",processData:false,contentType:false,method:"POST",beforeSend:function(){$(form).parent().find(".woozapp-loader").stop().fadeIn()},complete:function(){},success:function(data){if(!data.success){var invalid=data.validated.invalid;for(var p in invalid){var el=document.getElementById(p);removeInvalidFieldDescription.call(el);addInvalidFieldDescription.call(el,invalid[p])}}else{var content=document.querySelector(".woozapp-wrapper .row .main-content");content.innerHTML="";$(content).hide();content.innerHTML=data.msg;$(content).fadeIn(1200);content.classList.add("main-content--success")}$(form).parent().find(".woozapp-loader").fadeOut(1400)},error:function(jqXHR,textStatus,errorThrown){}})}},false)}$(window).ready(function(){iframeSourceLoder();validateInputs();ajaxSubmit()})})(jQuery);